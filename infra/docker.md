## 2025-04-04

### 프론트 - 백 소스 배포를 위해 컨테이너간 통신 연결 시 주의할 사항

프론트 소스를 웹서버와 같이 하나의 컨테이너에 구축하고, 서버는 같은 도커 네트워크의 다른 컨테이너에 WAS 와 구축한 경우 통신할 때 주의 할 사항이 있다.

단순 로컬에서 프론트-백 연결을 할 경우에는 프론트 쪽에서 API 호출 시 백 부분의 IP:포트 만을 작성하면되지만,

컨테이너로 올린 경우에는 브라우저 -> 프론트가 있는 컨테이너 -> 서버가 있는 컨테이너로 요청이 진행된다.

따라서 서버를 호출하는 호스트 주소를 서버 컨테이너가 아닌 프론트 컨테이너 쪽으로 잡아줘야 한다. 그래야 웹서버가 있는 컨테이너에서 리버스 프록시를 통해 서버로 요청을 다시 날린다.

<br>

예를 들어서 프론트 컨테이너가 192.168.1.1(IP) / test-front(컨테이너 이름) / 9090:80(포트), 서버 컨테이너가 192.168.1.1(IP) / test-back(컨테이너 이름) / 10001:8080(포트) 이라고 되었다면,

단순히 생각했을 때는 컨테이너끼리 같은 도커 네트워크에 있으니까 서버에 요청하는 url 을 test-back:8080 으로 요청을 보내도 되지 않을까 할 수 있다. (컨테이너 이름으로 호스트를 쓸 수 있으니까)

하지만 정답은 192.168.1.1:9090 으로 보내줘야 한다. 그래야 웹서버가 있는 컨테이너에서 앞서 말했든 서버로 요청을 보내줄 수 있다. (이 때 어디로 보내줄 지 웹서버에서 설정 필요)

우선 브라우저에서의 요청은 도커 내부에서의 통신이 아니기 때문에 컨테이너 이름으로 IP 를 대체할 수 없다. 그리고 서버 통신은 웹서버가 담당하므로, 웹서버가 있는 컨테이너로 먼저 요청을 날려야 한다.

브라우저에서 웹서버 쪽이 아니라 서버가 있는 컨테이너에 직접 192.168.1.1:10001 로 요청하는 방법도 있다. 다만 이 경우에는 웹서버를 거치지 않게된다.
